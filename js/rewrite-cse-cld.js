/* Copyright 2014 lennart.borgman@gmail.com */ (function(){(function(){function k(){document.querySelector("input.gsc-search-button")&&(c(),g())}function g(){document.querySelector("input.gsc-search-button").addEventListener("click",function(){c()});document.querySelector("#gsc-i-id1").addEventListener("keyup",function(a){console.log("keyCode",a.keyCode);13==a.keyCode&&(console.log("start keyCode",a.keyCode),c())});document.addEventListener("keyup",function(a){console.log("doc keyCode",a.keyCode);13==a.keyCode&&(console.log("doc start keyCode",a.keyCode),
c())});for(var a=document.querySelectorAll("div.gsc-cursor-page"),b=1;b<a.length;b++)a[b].addEventListener("click",function(){c();g()})}function c(){var a=document.querySelector("#___gcse_0 .gsc-wrapper .gsc-result div.gs-title a.gs-title");a&&(a.dataset.b="started");e&&clearInterval(e);e=setInterval(l,500)}function l(){var a=document.querySelectorAll("#___gcse_0 .gsc-wrapper .gsc-result div.gs-title a.gs-title");if(0!=a.length&&!a[0].dataset.b){clearInterval(e);e=null;for(var b=0;b<a.length;b++){a[b].href=
"http://dl.dropboxusercontent.com/u/848981/it/cw/zformat.html?z\x3d"+a[b].dataset.a+"\x26f\x3d"+f;delete a[b].dataset.c;txten=a[b];var h=a[b].innerText,c=h.substr(0,1);(h.match(/Zotero/)||h.match(/^Groups /)||c!=c.toUpperCase())&&m(a[b])}g()}}function m(a){var b=/https?:\/\/www.zotero.org\/groups\/(.*?)\/items\/itemKey\/([^/]*)/.exec(a.dataset.a),c=b[1],b=b[2],e=n[c];console.log(c,e);var d=new XMLHttpRequest;d.onload=function(){console.log("xhr callback ",d.status);if(200<=d.status&&400>d.status){var b=
d.responseText;zDom=(new DOMParser).parseFromString(b,"text/xml");b=zDom.querySelectorAll("content")[0].firstChild.nodeValue;x=b=JSON.parse(b);b=b.title;for(a.replaceChild(document.createTextNode(b),a.firstChild);a.firstChild;)a.removeChild(a.firstChild);a.appendChild(document.createTextNode(b))}else console.log("Couldn't read the requested file,\x3cbr /\x3estatus \x3d "+d.status.toString())};d.open("GET","https://api.zotero.org/groups/"+e+"/items/"+b+"?format\x3datom\x26content\x3djson",!0);d.setRequestHeader("Zotero-API-Version",
"2");d.send()}window.rewriteCseStart=function(){k()};var e,n={from_some_psychologists:56508,minding_my_mitochondria_terry_wahls:136570},f=window.location.href,f=f.replace(/\?.*/,"");console.log("hi, i am here! /rewrite-cse",f);k()})();})();